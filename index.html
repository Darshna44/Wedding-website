<script>
    // Password Protection
    function checkPassword() {
        const password = document.getElementById('passwordInput').value;
        const correctPassword = 'ElmoreCourt04!';
        
        if (password === correctPassword) {
            document.getElementById('passwordScreen').style.display = 'none';
            document.getElementById('mainContent').classList.add('active');
            sessionStorage.setItem('weddingAccess', 'true');
            
            // Initialize dashboard
            refreshDashboard();
            updateCountdown();
        } else {
            document.getElementById('passwordError').style.display = 'block';
            document.getElementById('passwordInput').value = '';
            
            // Hide error after 3 seconds
            setTimeout(() => {
                document.getElementById('passwordError').style.display = 'none';
            }, 3000);
        }
    }

    // Allow Enter key for password
    document.getElementById('passwordInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            checkPassword();
        }
    });

    // Check if already authenticated
    window.addEventListener('load', function() {
        if (sessionStorage.getItem('weddingAccess') === 'true') {
            document.getElementById('passwordScreen').style.display = 'none';
            document.getElementById('mainContent').classList.add('active');
            refreshDashboard();
            updateCountdown();
        }
    });

    // Dashboard Data Storage
    let dashboardData = {
        english: {
            responses: [],
            attending: 0,
            declined: 0,
            meals: {
                'Pan fried sea bass fillet, shaved fennel, dill & tomato cream': 0,
                'Chickpea panisse, courgette, Kalamata olive & mint salad, tarragon mayonnaise': 0,
                'Overnight lamb shoulder, chorizo & butterbean stew, harissa yoghurt (on the side)': 0,
                'Fried falafel, Cypriot grain & pomegranate salad, yoghurt & honey': 0,
                'Sticky toffee pudding, vanilla gelato': 0
            },
            dietary: []
        },
        indian: {
            responses: [],
            attending: 0,
            declined: 0,
            dietary: []
        }
    };

    // Refresh Dashboard Data
    async function refreshDashboard() {
        console.log('Dashboard initialized - waiting for real RSVP submissions');
        
        // Show "no data yet" states
        updateDashboardUI();
    }

    // Update Dashboard UI
    function updateDashboardUI() {
        const englishData = dashboardData.english;
        const indianData = dashboardData.indian;
        
        // Overall stats
        const totalResponses = englishData.responses.length + indianData.responses.length;
        const totalAttending = englishData.attending + indianData.attending;
        const estimatedGuests = 150; // Adjust this to your actual guest count
        const responseRate = estimatedGuests > 0 ? Math.round((totalResponses / estimatedGuests) * 100) : 0;
        
        document.getElementById('totalResponses').textContent = totalResponses;
        document.getElementById('totalAttending').textContent = totalAttending;
        document.getElementById('responseRate').textContent = responseRate + '%';
        document.getElementById('overallProgress').style.width = Math.min(responseRate, 100) + '%';
        
        // Wedding-specific stats
        document.getElementById('englishAttending').textContent = englishData.attending;
        document.getElementById('englishDeclined').textContent = englishData.declined;
        document.getElementById('englishTotal').textContent = englishData.responses.length;
        const englishRate = englishData.responses.length > 0 ? (englishData.attending / englishData.responses.length) * 100 : 0;
        document.getElementById('englishProgress').style.width = englishRate + '%';
        
        document.getElementById('indianAttending').textContent = indianData.attending;
        document.getElementById('indianDeclined').textContent = indianData.declined;
        document.getElementById('indianTotal').textContent = indianData.responses.length;
        const indianRate = indianData.responses.length > 0 ? (indianData.attending / indianData.responses.length) * 100 : 0;
        document.getElementById('indianProgress').style.width = indianRate + '%';
        
        // Update meal planning
        updateMealPlanning(englishData);
        
        // Update dietary requirements
        updateDietaryRequirements([...englishData.dietary, ...indianData.dietary]);
    }

    // Update Meal Planning
    function updateMealPlanning(englishData) {
        const mealContent = document.getElementById('mealPlanningContent');
        const totalMeals = Object.values(englishData.meals).reduce((sum, count) => sum + count, 0);
        
        if (totalMeals === 0) {
            mealContent.innerHTML = `
                <div class="no-data">
                    <p style="font-size: 1.1rem; margin-bottom: 1rem;">ðŸ“‹ No meal preferences recorded yet</p>
                    <p style="color: #a0896b;">Meal choices will appear here once guests start RSVPing</p>
                </div>
            `;
            return;
        }
        
        const mealHTML = Object.entries(englishData.meals).map(([meal, count]) => {
            const percentage = totalMeals > 0 ? (count / totalMeals) * 100 : 0;
            return `
                <div class="meal-item">
                    <span><strong>${meal}</strong></span>
                    <div class="meal-progress">
                        <div class="meal-progress-bar">
                            <div class="meal-progress-fill" style="width: ${percentage}%"></div>
                        </div>
                    </div>
                    <span><strong>${count}</strong></span>
                </div>
            `;
        }).join('');
        
        mealContent.innerHTML = mealHTML;
    }

    // Update Dietary Requirements
    function updateDietaryRequirements(allDietary) {
        const dietaryContent = document.getElementById('dietaryContent');
        
        if (allDietary.length === 0) {
            dietaryContent.innerHTML = `
                <div class="no-data">
                    <p style="font-size: 1.1rem; margin-bottom: 1rem;">ðŸ¥— No dietary requirements reported yet</p>
                    <p style="color: #a0896b;">Dietary restrictions will be listed here as guests RSVP</p>
                </div>
            `;
            return;
        }
        
        const dietaryHTML = allDietary.map(item => `
            <div class="dietary-item">
                <span class="name">${item.name}</span>
                <span class="requirement">${item.dietary}</span>
            </div>
        `).join('');
        
        dietaryContent.innerHTML = dietaryHTML;
    }

    // Update Countdown
    function updateCountdown() {
        const englishDate = new Date('2026-05-01T00:00:00');
        const now = new Date();
        const difference = englishDate - now;
        const days = Math.ceil(difference / (1000 * 60 * 60 * 24));
        
        document.getElementById('daysRemaining').textContent = days > 0 ? days : '0';
    }

    // Initialize countdown and refresh it daily
    setInterval(() => {
        updateCountdown();
    }, 86400000); // Update daily
</script>
